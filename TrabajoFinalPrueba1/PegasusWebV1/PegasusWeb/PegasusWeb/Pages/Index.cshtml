@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <h1 class="display-4">Pegasus</h1>
    <p>Bienvenidos</p>
</div>

<h1>Login con Google</h1>
<button id="loginGoogleBtn">Iniciar sesión con Google</button>

<script>
    // Función que llama al backend para iniciar el proceso de autenticación
    document.getElementById('loginGoogleBtn').addEventListener('click', async function () {
        // Hacemos una llamada a la ruta de login en tu backend
        //const returnUrl = 'https://localhost:7063/signin-google';
        const returnUrl = 'https://localhost:7063';
        const loginUrl = `https://localhost:7130/Account/Login?returnUrl=${encodeURIComponent(returnUrl)}`;
        window.location.href = loginUrl;
        //window.location.href = "https://localhost:7130/Account/Login";
    });
    //document.getElementById('loginGoogleBtn').addEventListener('click', async function () {
    //    // Llama a tu backend para iniciar el proceso de autenticación
    //    //const response = await fetch('https://localhost:7130/Account/Login?returnUrl=https://localhost:7063/signin-google');
    //    const response = await fetch('https://localhost:7130/Account/Login');

    //    if (response.ok) {
    //        const userData = await response.json();
    //        // Guardar el usuario en la sesión
    //        sessionStorage.setItem('user', JSON.stringify(userData));
    //        console.log('Usuario autenticado:', userData);
    //        // Redirige a donde desees
    //        window.location.href = 'https://localhost:7063'; // o cualquier otra página
    //    } else {
    //        console.error('Error en la solicitud de autenticación:', response.statusText);
    //    }
    //});

    function getQueryParams() {
        const params = {};
        const queryString = window.location.search.substring(1);
        const pairs = queryString.split("&");

        pairs.forEach(pair => {
            const [key, value] = pair.split("=");
            params[decodeURIComponent(key)] = decodeURIComponent(value);
        });

        return params;
    }

    // Al cargar la página, obtener los datos del usuario
    window.onload = function () {
        const userData = getQueryParams();

        // Guardar en sessionStorage
        if (userData.email) {
            sessionStorage.setItem('userEmail', userData.email);
            sessionStorage.setItem('userPerfil', userData.perfil);

            console.log('Datos del usuario:', userData.email, userData.perfil);
        }
    };
</script>
